<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de Paro – Célula de Esmaltado</title>
</head>

<body>

<h1>Registro de Paro</h1>

<form method="post" action="http://127.0.0.1:5000/registrar_paro">


    <!-- 1. Operario -->
    <fieldset>
        <legend><strong>Operario</strong></legend>
        <label>Nombre del operario:</label><br>
        <select id="operario" name="operario" required>
            <option value="">Seleccione</option>
            <option>German Muñoz</option>
            <option>Carlos Rua</option>
            <option>Dairon Vanegas</option>
            <option>Jonatan Estrada</option>
            <option>Felipe Cadavid</option>
            <option>Camilo Niño</option>
            <option>Faber Mesa</option>
            <option>Gustavo Moreno</option>
            <option>Juan Manuel Hernández</option>
        </select>
    </fieldset>

    <br>

    <!-- 2. Célula -->
    <fieldset>
        <legend><strong>Célula</strong></legend>
        <label>Número de célula:</label><br>
        <select id="celula" name="celula" required>
            <option value="">Seleccione</option>
            <option value="1">Célula 1</option>
            <option value="2">Célula 2</option>
            <option value="3">Célula 3</option>
            <option value="4">Célula 4</option>
        </select>
    </fieldset>

    <br>

    <!-- 3. Tipo de Paro -->
    <fieldset>
        <legend><strong>Tipo de Paro</strong></legend>
        <input type="radio" name="tipo_evento" value="operativo" required> Operativo<br>
        <input type="radio" name="tipo_evento" value="tecnico"> Técnico
    </fieldset>

    <br>

            <!-- 4. Causa -->
        <fieldset>
            <legend><strong>Causa del Paro</strong></legend>

            <!-- 123 Operativo -->
            <select id="causa_op_123" style="display:none;">
                <option value="">Seleccione</option>
                <option>Descarga</option>
                <option>Carga</option>
                <option>Falta producción</option>
            </select>

            <!-- 123 Técnico -->
            <select id="causa_tec_123" style="display:none;">
                <option value="">Seleccione</option>
                <option>Conveyor entrada</option>
                <option>Sensores</option>
                <option>Escuadra</option>
                <option>Elevador 1</option>
                <option>Elevador 2</option>
                <option>Cadenas</option>
                <option>Conveyor salida</option>
                <option>Sensores conveyor de salida</option>
                <option>Motor de extracción</option>
                <option>Centralina</option>
                <option>Correas</option>
                <option>Esponjas</option>
                <option>Cabina</option>
                <option>Torretas</option>
                <option>Giostra</option>
                <option>Puertas cabina</option>
                <option>Sifón</option>
                <option>Sensor llenado</option>
                <option>Sensor presencia</option>
                <option>Cilindros de llenado</option>
                <option>Sistema llenado</option>
                <option>Bomba</option>
                <option>Tamiz</option>
                <option>Válvula fisher llenado</option>
                <option>Válvula fisher sifón</option>
                <option>GDS</option>
                <option>Válvulas de GDS</option>
                <option>Sensores tanque</option>
                <option>Robot manipulador</option>
                <option>Pinzas</option>
                <option>Cilindros de pinzas</option>
                <option>Perfiles</option>
                <option>Ángulos</option>
                <option>Robot esmaltador</option>
                <option>Pistola</option>
                <option>Otro</option>
            </select>

            <!-- 4 Operativo -->
            <select id="causa_op_4" style="display:none;">
                <option value="">Seleccione</option>
                <option>Descarga</option>
                <option>Carga</option>
                <option>Falta producción</option>
            </select>

            <!-- 4 Técnico -->
            <select id="causa_tec_4" style="display:none;">
                <option value="">Seleccione</option>
                <option>Línea A</option>
                <option>Sensores Línea A</option>
                <option>Elevadores Línea A</option>
                <option>Servo Línea A</option>
                <option>Línea B</option>
                <option>Sensores Línea B</option>
                <option>Servo Línea B</option>
                <option>Elevadores Línea B</option>
                <option>Torreta 1</option>
                <option>Limpiador Torreta 1</option>
                <option>Torreta 2</option>
                <option>Limpiador Torreta 2</option>
                <option>Línea C</option>
                <option>Sensores Línea C</option>
                <option>Elevadores Línea C</option>
                <option>Motor de extracción</option>
                <option>Sifón</option>
                <option>Sensor llenado sifón</option>
                <option>Sensor presencia sifón</option>
                <option>Cilindros sifón</option>
                <option>Sistema llenado</option>
                <option>Bomba</option>
                <option>Tamiz</option>
                <option>Válvulas fisher sifón</option>
                <option>Válvulas fisher GDS</option>
                <option>GDS</option>
                <option>Pistola</option>
                <option>Válvulas PV de GDS</option>
                <option>Sensores tanque</option>
                <option>Otro</option>
            </select>

            <input type="hidden" id="causa_final" name="causa">
        </fieldset>

    <br>

    <!-- 5. Duración -->
    <fieldset>
        <legend><strong>Duración</strong></legend>
        <label>Duración del paro (minutos):</label><br>
        <input type="number" name="duracion_minutos" min="1" required>
    </fieldset>

    <br>

    <!-- Envío -->
    <input type="hidden" name="estado" value="cerrado">
    <button type="submit" id="btnRegistrar" disabled>Registrar Paro</button>

    <p id="mensajeAyuda" style="color:red;">
        Seleccione célula y causa para continuar.
    </p>

</form>

<script>
const celula = document.getElementById("celula");
const tipos = document.getElementsByName("tipo_evento");
const boton = document.getElementById("btnRegistrar");
const mensaje = document.getElementById("mensajeAyuda");
const causaFinal = document.getElementById("causa_final");

const causa_op_123 = document.getElementById("causa_op_123");
const causa_tec_123 = document.getElementById("causa_tec_123");
const causa_op_4 = document.getElementById("causa_op_4");
const causa_tec_4 = document.getElementById("causa_tec_4");

const todos = [causa_op_123, causa_tec_123, causa_op_4, causa_tec_4];

function ocultarTodo() {
    todos.forEach(s => {
        s.style.display = "none";
        s.value = "";
    });
    causaFinal.value = "";
    boton.disabled = true;
    mensaje.style.display = "block";
}

function obtenerTipo() {
    for (let r of tipos) {
        if (r.checked) return r.value;
    }
    return "";
}

function mostrarCausaCorrecta() {
    ocultarTodo();

    const tipo = obtenerTipo();
    const cel = celula.value;

    if (!tipo || !cel) return;

    let select = null;

    if (cel === "4") {
        select = (tipo === "operativo") ? causa_op_4 : causa_tec_4;
    } else {
        select = (tipo === "operativo") ? causa_op_123 : causa_tec_123;
    }

    if (select) {
        select.style.display = "block";
    }
}

function validarFormulario() {
    const visible = todos.find(s => s.style.display === "block");

    if (visible && visible.value !== "") {
        causaFinal.value = visible.value;
        boton.disabled = false;
        mensaje.style.display = "none";
    } else {
        boton.disabled = true;
        mensaje.style.display = "block";
    }
}

/* EVENTOS */
celula.addEventListener("change", () => {
    mostrarCausaCorrecta();
    validarFormulario();
});

tipos.forEach(r => {
    r.addEventListener("change", () => {
        mostrarCausaCorrecta();
        validarFormulario();
    });
});

todos.forEach(s => {
    s.addEventListener("change", validarFormulario);
});

window.onload = ocultarTodo;
</script>
