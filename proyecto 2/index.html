<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Condiciones Básicas – Esmaltado Robotizado Tazas</title>

    <style>
        body {
            background-color: hsl(0, 0%, 95%);
            font-family: Arial, sans-serif;
            font-size: 18px;
        }

        h1 {
            font-size: 25px;
            color: #ef6c00;
        }

        fieldset {
            background-color: #ffffff;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 6px;
        }

        legend {
            font-size: 20px;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        td:first-child {
             text-align: left;
        }

        th {
            background-color: #e6e6e6;
        }

        select, button {
            font-size: 18px;
            padding: 6px;
        }

        .celula-select {
            display: none;
            text-align: left;
        }

        .celula-select label {
            margin-right: 10px;
        }
        .celula-select label {
        display: inline-block;
        margin-right: 12px;
        }
        .datos-generales-row {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .campo {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }

        .campo label {
            font-weight: bold;
            margin-bottom: 4px;
        }

        
    </style>
</head>
<body>

<h1>Condiciones Básicas – Esmaltado Robotizado Tazas</h1>

<form>

    <!-- Encabezado -->
    <fieldset>

        <legend>Datos Generales</legend>

        <div class="datos-generales-row">

            <div class="campo">
                <label>Fecha</label>
                <input type="date" id="fecha" required>
            </div>

            <div class="campo">
                <label>Turno</label>
                <select id="turno" required>
                    <option value="">Seleccione</option>
                    <option value="1">Turno 1</option>
                    <option value="2">Turno 2</option>
                    <option value="3">Turno 3</option>
                </select>
            </div>

            <div class="campo">
                <label>Inspector</label>
                <select id="inspector" required>
                    <option value="">Seleccione</option>
                    <option>German Muñoz</option>
                    <option>Carlos Rua</option>
                    <option>Dairon Vanegas</option>
                    <option>Jonatan Estrada</option>
                    <option>Felipe Cadavid</option>
                    <option>Camilo Niño</option>
                    <option>Faber Mesa</option>
                    <option>Gustavo Moreno</option>
                    <option>Juan Manuel Hernández</option>
                </select>
            </div>

        </div>

    </fieldset>


    <!-- Condiciones Básicas -->
    <fieldset id="condiciones">

        <legend>Condiciones Básicas</legend>

        <table>
            <thead>
                <tr>
                    <th>Condición</th>
                    <th>¿Se cumple?</th>
                    <th>Célula (solo si NO se cumple)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Aplicación sin textura rayada, esmalte chorreado o polvo excesivo</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Pinzas con desgaste y/o desajuste</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Pinzas abren y cierran correctamente y sin vibraciones</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Pistola sin goteo, racores y mangueras en buen estado</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Torretas y cauchos en buen estado y bien niveladas</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Limpiador de boquilla centrado</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Filtro de esmalte limpio y sin fisuras</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Tinas de esmalte sifón lavadas en el turno</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Caucho del sistema sifón limpio y sin acumulación</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Boquilla de llenado sifón limpia</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Cilindro de boquilla sifón lubricado y sin vibraciones</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Escuadra de centraje bien ajustada</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Nivel de esmalte sifón correcto</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Limpieza de HS de la taza correcta</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Sensor de flujo másico calibrado a cero</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Reporte de productividad de células actualizado</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Reporte de rotura esmaltada registrado</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Registro de pérdidas mayores y menores diligenciado</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
                <tr>
                    <td>Revisión general de la célula realizada</td>
                    <td><select class="cumple"><option value="">Seleccione</option><option value="si">Sí</option><option value="no">No</option></select></td>
                    <td class="celula-select">
                        <label><input type="checkbox" value="1"> 1</label>
                        <label><input type="checkbox" value="2"> 2</label>
                        <label><input type="checkbox" value="3"> 3</label>
                        <label><input type="checkbox" value="4"> 4</label>
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>

    <button type="submit" id="btnRegistrar" disabled>Registrar Inspección</button>
    <form method="post" action="http://127.0.0.1:5000/registrar_inspeccion">


</form>

<script>
const filas = document.querySelectorAll("#condiciones tbody tr");

filas.forEach((fila, index) => {
    // Select Sí / No
    const selectCumple = fila.querySelector(".cumple");
    selectCumple.name = `cumple_${index}`;

    // Checkboxes de células
    const checks = fila.querySelectorAll(".celula-select input[type='checkbox']");
    checks.forEach(check => {
        check.name = `celulas_${index}[]`;
    });
});

document.addEventListener("DOMContentLoaded", () => {

    /* ===============================
       REFERENCIAS GENERALES
    ================================ */

    const fechaInput = document.getElementById("fecha");
    const turnoSelect = document.getElementById("turno");
    const inspectorSelect = document.getElementById("inspector");
    const condiciones = document.getElementById("condiciones");
    const btnRegistrar = document.getElementById("btnRegistrar");
    const cumpleSelects = document.querySelectorAll(".cumple");

    /* ===============================
       LÓGICA CONDICIONES BÁSICAS
    ================================ */

    cumpleSelects.forEach(select => {
        select.addEventListener("change", () => {
            const fila = select.closest("tr");
            const celulaSelect = fila.querySelector(".celula-select");

            if (select.value === "no") {
                celulaSelect.style.display = "block";
            } else {
                celulaSelect.style.display = "none";
                celulaSelect.querySelectorAll("input").forEach(c => c.checked = false);
            }

            validarFormularioCompleto();
        });
    });

    document.querySelectorAll(".celula-select input").forEach(check => {
        check.addEventListener("change", validarFormularioCompleto);
    });

    /* ===============================
       VALIDACIÓN FORMULARIO COMPLETO
    ================================ */

    function validarFormularioCompleto() {
        let valido = true;

        cumpleSelects.forEach(select => {
            if (select.value === "") {
                valido = false;
                return;
            }

            if (select.value === "no") {
                const fila = select.closest("tr");
                const checks = fila.querySelectorAll(".celula-select input[type='checkbox']");
                const algunoMarcado = Array.from(checks).some(c => c.checked);

                if (!algunoMarcado) {
                    valido = false;
                }
            }
        });

        btnRegistrar.disabled = !valido;
    }

    /* ===============================
       SEGURIDAD OPERATIVA
    ================================ */

    function esFechaHoy() {
        const hoy = new Date().toISOString().split("T")[0];
        return fechaInput.value === hoy;
    }

    function turnoValido() {
        const hora = new Date().getHours();
        const turno = turnoSelect.value;

        if (turno === "1") return hora >= 6 && hora < 14;
        if (turno === "2") return hora >= 14 && hora < 22;
        if (turno === "3") return hora >= 22 || hora < 6;

        return false;
    }

    function validarAccesoCondiciones() {
        if (esFechaHoy() && turnoValido() && inspectorSelect.value !== "") {
            condiciones.style.opacity = "1";
            condiciones.style.pointerEvents = "auto";
        } else {
            condiciones.style.opacity = "0.4";
            condiciones.style.pointerEvents = "none";
        }
    }

    function restringirTurnosPorHora() {
        const hora = new Date().getHours();

        turnoSelect.querySelectorAll("option").forEach(op => {
            if (op.value === "") return;

            if (op.value === "1") op.disabled = !(hora >= 6 && hora < 14);
            if (op.value === "2") op.disabled = !(hora >= 14 && hora < 22);
            if (op.value === "3") op.disabled = !(hora >= 22 || hora < 6);
        });
    }

    /* ===============================
       INICIALIZACIÓN
    ================================ */

    const hoy = new Date().toISOString().split("T")[0];
    fechaInput.value = hoy;
    fechaInput.min = hoy;
    fechaInput.max = hoy;

    condiciones.style.opacity = "0.4";
    condiciones.style.pointerEvents = "none";
    btnRegistrar.disabled = true;

    restringirTurnosPorHora();
    validarAccesoCondiciones();
    validarFormularioCompleto();

    fechaInput.addEventListener("change", validarAccesoCondiciones);
    turnoSelect.addEventListener("change", validarAccesoCondiciones);
    inspectorSelect.addEventListener("change", validarAccesoCondiciones);

});
</script>
